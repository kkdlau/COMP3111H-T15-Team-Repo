<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Controller.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">deCOVID</a> &gt; <a href="index.source.html" class="el_package">comp3111.covid</a> &gt; <span class="el_source">Controller.java</span></div><h1>Controller.java</h1><pre class="source lang-java linenums">package comp3111.covid;

import javafx.beans.property.DoubleProperty;
import javafx.beans.property.SimpleDoubleProperty;
import javafx.beans.value.ChangeListener;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.Node;
import javafx.scene.text.Text;
import javafx.scene.chart.CategoryAxis;
import javafx.scene.chart.LineChart;
import javafx.scene.chart.NumberAxis;
import javafx.scene.chart.XYChart;
import javafx.scene.control.*;
import javafx.scene.control.cell.MapValueFactory;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.chart.XYChart.Series;
import javafx.scene.chart.ScatterChart;
import javafx.scene.layout.HBox;
import javafx.scene.layout.StackPane;
import javafx.scene.layout.VBox;
import javafx.stage.Stage;

import java.net.URL;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.time.temporal.ChronoUnit;
import java.util.*;
import java.util.stream.Collectors;

/**
 * A singleton class that consist of deep copy methods.
 */
class DeepCopyUtils {
    private DeepCopyUtils() {

    }

    /**
     * Performs deep copying on a series of data.
     *
     * @param series series to copy
     * @param &lt;S&gt;    type of X axis
     * @param &lt;T&gt;    type of Y axis
     * @return deep copied series
     */
    public static &lt;S, T&gt; XYChart.Series&lt;S, T&gt; copySeries(XYChart.Series&lt;S, T&gt; series) {
<span class="fc" id="L50">        XYChart.Series&lt;S, T&gt; copy = new XYChart.Series&lt;&gt;(series.getName(),</span>
<span class="fc" id="L51">                series.getData().stream()</span>
<span class="fc" id="L52">                        .map(data -&gt; new XYChart.Data&lt;S, T&gt;(data.getXValue(), data.getYValue()))</span>
<span class="fc" id="L53">                        .collect(Collectors.toCollection(FXCollections::observableArrayList)));</span>
<span class="fc" id="L54">        return copy;</span>
    }
}

<span class="fc" id="L58">public class Controller implements Initializable {</span>

<span class="fc" id="L60">    ToggleGroup ratioButtonGroups = new ToggleGroup();</span>
<span class="fc" id="L61">    UIDataModel dataInstance = new UIDataModel();</span>
    ObservableList&lt;XYChart.Series&lt;String, Float&gt;&gt; unshifted;
    ObservableList&lt;XYChart.Series&lt;String, Float&gt;&gt; shifted;
<span class="fc" id="L64">    DoubleProperty aShift = new SimpleDoubleProperty();</span>
<span class="fc" id="L65">    DoubleProperty bShift = new SimpleDoubleProperty();</span>
    @FXML
    private Tab tabTask12;
    @FXML
    private TextField textfieldDataset;
    @FXML
    private CheckBox acumulativeCheckButton;
    @FXML
    private Label countryInstruction;
    @FXML
    ListView&lt;String&gt; countryListView;
    @FXML
    private RadioButton dataCaseButton;
    @FXML
    private RadioButton dataDeathButton;
    @FXML
    private TableView dataTable;
    @FXML
    private RadioButton dataVaccinButton;
    @FXML
    private Label endDataLabel;
    @FXML
    private DatePicker endDatePicker;
    @FXML
    private Label startDateLabel;
    @FXML
    private DatePicker startDatePicker;
    @FXML
    private Button generateButton;
    @FXML
    private TitledPane dataRangeTile;
    @FXML
    private TitledPane countryFilter;
    @FXML
    private LineChart chart;
    @FXML
    private NumberAxis chartXAxis;
    @FXML
    private CategoryAxis chartYAxis;
    @FXML
    private StackPane stack;
    // Report B
    @FXML
    private Tab b3Tab;
    @FXML
    ScrollPane reportB;
    @FXML
    private ScatterChart chartReportB1, chartReportB2, chartReportB3;
    @FXML
    private Button buttonReportB1;
    @FXML
    private Label taskB1correlation, taskB2correlation, taskB3correlation, LabelSliderReportB3;
    @FXML
    private Label ResultB1, ResultB2, ResultB3;
    @FXML
    private Slider SliderReportB3;
    // Report C
    @FXML
    private Tab c3Tab;
    @FXML
    ScrollPane reportC;
    @FXML
    private Button buttonReportC1, buttonReportC2, buttonReportC3;
    @FXML
    private LineChart chartReportC1, chartReportC3;
    @FXML
    private ScatterChart chartReportC2;
    @FXML
    private TableView tableReportC1;
    @FXML
    Text chartReportC1Title, chartReportC2Title, chartReportC3Title;

    @FXML
    private HBox rootUI;
    @FXML
    private VBox rightUI;
    @FXML
    TabPane tabGroup;
    @FXML
    private Label title;
    @FXML
    private Button chartGenerateButton;
    @FXML
    private ListView&lt;String&gt; countryAListView;
    @FXML
    Slider countryASlider;
    @FXML
    private ListView&lt;String&gt; countryBListView;
    @FXML
    private Slider countryBSlider;
    @FXML
    private LineChart compareChart;
    @FXML
    private LineChart&lt;Float, Float&gt; caseDeathChart;
    @FXML
    private Button caseDeathGenerateButton;
    @FXML
    private Label countryAShiftText;
    @FXML
    private Label countryBShiftText;
    @FXML
    Label regressionReport;
    @FXML
    ScrollPane reportA;
    @FXML
    private Tab a3Tab;

<span class="fc" id="L172">    private boolean init = false;</span>


<span class="fc" id="L175">    ChangeListener&lt;Tab&gt; onTabChanged = (ov, disSelected, selected) -&gt; {</span>
<span class="fc" id="L176">        rightUI.getChildren().clear();</span>

<span class="fc bfc" id="L178" title="All 2 branches covered.">        if (disSelected == tabTask12) {</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">        } else if (disSelected == a3Tab) {</span>
<span class="fc" id="L180">            countryFilter.setExpanded(true);</span>
<span class="fc" id="L181">            countryFilter.setVisible(true);</span>
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">        } else if (disSelected == b3Tab) {</span>
<span class="fc" id="L183">            countryInstruction.setVisible(true);</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">        } else if (disSelected == c3Tab) {</span>
<span class="nc" id="L185">            countryInstruction.setVisible(true);</span>
        }

<span class="pc bpc" id="L188" title="1 of 2 branches missed.">        if (selected == tabTask12) {</span>
<span class="nc" id="L189">            rightUI.getChildren().add(title);</span>
<span class="nc" id="L190">            rightUI.getChildren().add(stack);</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">            this.showTaskUI(!dataInstance.acumulativeData.get());</span>
<span class="fc bfc" id="L192" title="All 2 branches covered.">        } else if (selected == a3Tab) {</span>
<span class="fc" id="L193">            countryFilter.setExpanded(false);</span>
<span class="fc" id="L194">            countryFilter.setVisible(false);</span>
<span class="fc" id="L195">            rightUI.getChildren().add(title);</span>
<span class="fc" id="L196">            rightUI.getChildren().add(stack);</span>
<span class="fc" id="L197">            title.setText(&quot;COVID-19 Confirmed Cases Report&quot;); // update title</span>
<span class="fc" id="L198">            showPickPeriodUI();</span>
<span class="fc" id="L199">            this.showReportUI(InterestedData.ConfirmedCases);</span>
<span class="fc bfc" id="L200" title="All 2 branches covered.">        } else if (selected == b3Tab) {</span>
<span class="fc" id="L201">            rightUI.getChildren().add(stack);</span>
<span class="fc" id="L202">            this.showReportUI(InterestedData.ConfirmedDeaths);</span>
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">        } else if (selected == c3Tab) {</span>
<span class="fc" id="L204">            rightUI.getChildren().add(stack);</span>
<span class="fc" id="L205">            this.showReportUI(InterestedData.RateOfVaccination);</span>
        }
<span class="fc" id="L207">    };</span>
    private Stage window;

    /**
     * Sets the stage that the controller belongs to.
     *
     * @param stage stage that the controller belongs to
     */
    public void setStage(Stage stage) {
<span class="fc" id="L216">        this.window = stage;</span>
<span class="fc" id="L217">    }</span>

    /**
     * Initialize the cotroller.
     */
    public void initialize() {
        // default data for data pickers

<span class="fc" id="L225">        startDatePicker.setValue(LocalDate.now());</span>
<span class="fc" id="L226">        endDatePicker.setValue(LocalDate.now());</span>
<span class="fc" id="L227">        chartXAxis.setAutoRanging(true);</span>
<span class="fc" id="L228">        chartYAxis.setAutoRanging(true);</span>

<span class="fc" id="L230">        this.initializeUIDataModel();</span>
<span class="fc" id="L231">        this.ratioButtonInitialize();</span>

        // Let list view listens to changes of getAvailableCountries().
        // So that when a new dataset is loaded, the list will update also.
<span class="fc" id="L235">        countryListView.getSelectionModel().setSelectionMode(SelectionMode.MULTIPLE);</span>
<span class="fc" id="L236">        countryListView.setItems(dataInstance.getAvailableCountries());</span>

<span class="pc" id="L238">        startDatePicker.valueProperty().addListener((ob, oldV, newV) -&gt; dataInstance.start = newV);</span>

<span class="pc" id="L240">        endDatePicker.valueProperty().addListener((ob, oldV, newV) -&gt; dataInstance.end = newV);</span>

<span class="fc" id="L242">        generateButton.setOnAction((e) -&gt; {</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">            if (dataInstance.acumulativeData.get())</span>
<span class="nc" id="L244">                this.generateChart(dataInstance);</span>
            else
<span class="nc" id="L246">                this.generateTable(dataInstance);</span>
<span class="nc" id="L247">        });</span>

<span class="fc" id="L249">        dataInstance.acumulativeData.addListener((e) -&gt; {</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">            showTaskUI(!dataInstance.acumulativeData.get());</span>
<span class="nc" id="L251">        });</span>

<span class="fc" id="L253">        tabGroup.getSelectionModel().selectedItemProperty().addListener(onTabChanged);</span>

<span class="fc" id="L255">        acumulativeCheckButton.setSelected(false);</span>
<span class="fc" id="L256">        textfieldDataset.setText(textfieldDataset.getText());</span>

<span class="fc" id="L258">        dataInstance.dataPath.setValue(textfieldDataset.getText());</span>

<span class="fc" id="L260">        tabTaskA3Initialize();</span>
<span class="fc" id="L261">        tabTaskB3Initialize();</span>
<span class="fc" id="L262">        tabTaskC3Initialize();</span>

<span class="fc" id="L264">        stack.getChildren().clear();</span>
<span class="pc bpc" id="L265" title="1 of 2 branches missed.">        this.showTaskUI(!dataInstance.acumulativeData.get());</span>

<span class="fc" id="L267">        tabGroup.getSelectionModel().select(0); // select task 1&amp;2 tab by default</span>
<span class="fc" id="L268">        init = true;</span>
<span class="fc" id="L269">    }</span>

    /**
     * Initialize UI components for tab B3.
     */
    void tabTaskB3Initialize() {
<span class="fc" id="L275">        buttonReportB1.setOnAction((e) -&gt; {</span>
<span class="nc" id="L276">            errorCheckOneCountry();</span>
<span class="nc" id="L277">            this.generateChartB1(dataInstance);</span>
<span class="nc" id="L278">            this.generateChartB2(dataInstance);</span>
<span class="nc" id="L279">            this.generateChartB3(dataInstance);</span>
<span class="nc" id="L280">        });</span>

<span class="fc" id="L282">        SliderReportB3.setOnMouseReleased((e) -&gt; {</span>
<span class="nc" id="L283">            LabelSliderReportB3.setText((int) SliderReportB3.getValue() + &quot;-days death cases are observed after vaccination &quot;);</span>
<span class="nc" id="L284">            errorCheckOneCountry();</span>
<span class="nc" id="L285">            this.generateChartB3(dataInstance);</span>
<span class="nc" id="L286">        });</span>
<span class="fc" id="L287">    }</span>
    /**
     * Initialize UI components for tab C3.
     */
    void tabTaskC3Initialize() {
<span class="fc" id="L292">        buttonReportC1.setOnAction((e) -&gt; {</span>
<span class="nc" id="L293">            this.generateChartC1(dataInstance);</span>
<span class="nc" id="L294">        });</span>
<span class="fc" id="L295">        buttonReportC2.setOnAction((e) -&gt; {</span>
<span class="nc" id="L296">            this.generateChartC2(dataInstance);</span>
<span class="nc" id="L297">        });</span>
<span class="fc" id="L298">        buttonReportC3.setOnAction((e) -&gt; {</span>
<span class="nc" id="L299">            this.generateChartC3(dataInstance);</span>
<span class="nc" id="L300">        });</span>
<span class="fc" id="L301">    }</span>

    /**
     * Initialize UI components for tab A3.
     */
    void tabTaskA3Initialize() {
<span class="fc" id="L307">        countryAListView.setItems(dataInstance.getAvailableCountries());</span>
<span class="fc" id="L308">        countryBListView.setItems(dataInstance.getAvailableCountries());</span>

<span class="pc" id="L310">        countryAListView.setOnMouseClicked((e) -&gt; countryASlider.setDisable(false));</span>
<span class="pc" id="L311">        countryBListView.setOnMouseClicked((e) -&gt; countryBSlider.setDisable(false));</span>

<span class="pc bpc" id="L313" title="1 of 2 branches missed.">        if (countryAListView.getSelectionModel().getSelectedItems().size() == 0) {</span>
<span class="fc" id="L314">            countryASlider.setDisable(true);</span>
        } else {
<span class="nc" id="L316">            countryASlider.setDisable(false);</span>
        }

<span class="pc bpc" id="L319" title="1 of 2 branches missed.">        if (countryBListView.getSelectionModel().getSelectedItems().size() == 0) {</span>
<span class="fc" id="L320">            countryBSlider.setDisable(true);</span>
        } else {
<span class="nc" id="L322">            countryBSlider.setDisable(false);</span>
        }

<span class="fc" id="L325">        chartGenerateButton.setOnAction((e) -&gt; {</span>
            try {
<span class="nc" id="L327">                generateComparisonChart(dataInstance);</span>
<span class="nc" id="L328">            } catch (Exception exception) {</span>
<span class="nc" id="L329">                PromptHelper.showErrorPrompt(window, exception.getMessage());</span>
<span class="nc" id="L330">            }</span>
<span class="nc" id="L331">        });</span>
<span class="fc" id="L332">        caseDeathGenerateButton.setOnAction((e) -&gt; {</span>
            try {
<span class="nc" id="L334">                generateRegressionChart(dataInstance);</span>
<span class="nc" id="L335">            } catch (Exception exception) {</span>
<span class="nc" id="L336">                PromptHelper.showErrorPrompt(window, exception.getMessage());</span>
<span class="nc" id="L337">            }</span>
<span class="nc" id="L338">        });</span>

<span class="fc" id="L340">        aShift.bindBidirectional(countryASlider.valueProperty());</span>
<span class="fc" id="L341">        bShift.bindBidirectional(countryBSlider.valueProperty());</span>

<span class="fc" id="L343">        aShift.addListener((e) -&gt; {</span>
<span class="nc" id="L344">            double d = aShift.getValue();</span>
<span class="nc" id="L345">            countryAShiftText.setText(String.format(&quot;X-axis shift for country A(The situation has been postponed for %d days):&quot;, (int) d));</span>
<span class="nc bnc" id="L346" title="All 4 branches missed.">            if (shifted != null &amp;&amp; d != 0)</span>
<span class="nc" id="L347">                shiftingData();</span>
<span class="nc" id="L348">        });</span>

<span class="fc" id="L350">        bShift.addListener((e) -&gt; {</span>
<span class="nc" id="L351">            double d = bShift.getValue();</span>
<span class="nc" id="L352">            countryBShiftText.setText(String.format(&quot;X-axis shift for country B(The situation has been postponed for %d days):&quot;, (int) d));</span>
<span class="nc bnc" id="L353" title="All 4 branches missed.">            if (shifted != null &amp;&amp; d != 0)</span>
<span class="nc" id="L354">                shiftingData();</span>
<span class="nc" id="L355">        });</span>

<span class="fc" id="L357">        compareChart.getYAxis().setLabel(&quot;Confirmed Cases (per M)&quot;);</span>
<span class="fc" id="L358">        compareChart.getXAxis().setLabel(&quot;Date&quot;);</span>

<span class="fc" id="L360">        caseDeathChart.setCreateSymbols(false);</span>
<span class="fc" id="L361">        caseDeathChart.setAnimated(false);</span>
<span class="fc" id="L362">        caseDeathChart.getXAxis().setLabel(&quot;Confirmed Cases (per M)&quot;);</span>
<span class="fc" id="L363">        caseDeathChart.getYAxis().setLabel(&quot;Confirmed Deaths (per M)&quot;);</span>
<span class="fc" id="L364">    }</span>

    /**
     * Generates regression model and display on the chart.
     *
     * @param data data model
     * @throws Exception the error occurs during the generation, can be caught to get the fail message
     */
    void generateRegressionChart(UIDataModel data) throws Exception {
<span class="fc" id="L373">        caseDeathChart.getData().clear();</span>

<span class="fc" id="L375">        String iDataset = data.dataPath.get();</span>

<span class="fc" id="L377">        String[] selectedCountries = new String[]{</span>
<span class="fc" id="L378">                countryAListView.getSelectionModel().getSelectedItem(),</span>
<span class="fc" id="L379">                countryBListView.getSelectionModel().getSelectedItem(),</span>
        };

<span class="fc" id="L382">        Object[] ISO = dataInstance.getISOList(FXCollections.observableList(Arrays.asList(selectedCountries)));</span>
<span class="fc" id="L383">        String[] ISOStrings = Arrays.copyOf(ISO, ISO.length, String[].class);</span>

<span class="pc bpc" id="L385" title="3 of 4 branches missed.">        if (selectedCountries[0] == null || selectedCountries[1] == null) {</span>
<span class="fc" id="L386">            throw new Exception(&quot;Please select at least one country&quot;);</span>
        }

<span class="nc" id="L389">        ObservableList&lt;XYChart.Series&lt;Float, Float&gt;&gt; d = DataAnalysis.casesAndDeathsData(iDataset, ISOStrings[0], ISOStrings[1]);</span>
<span class="nc" id="L390">        d.get(0).setName(selectedCountries[0]);</span>
<span class="nc" id="L391">        d.get(1).setName(selectedCountries[1]);</span>

<span class="nc" id="L393">        LinearRegression regressionA = LinearRegression.fromSeries(d.get(0));</span>
<span class="nc" id="L394">        XYChart.Series rgA = regressionA.generateMockData();</span>
<span class="nc" id="L395">        rgA.setName(String.format(&quot;Regression - %s&quot;, selectedCountries[0]));</span>

<span class="nc" id="L397">        LinearRegression regressionB = LinearRegression.fromSeries(d.get(1));</span>
<span class="nc" id="L398">        XYChart.Series rgB = regressionB.generateMockData();</span>
<span class="nc" id="L399">        rgB.setName(String.format(&quot;Regression - %s&quot;, selectedCountries[1]));</span>

<span class="nc" id="L401">        d.add(rgA);</span>
<span class="nc" id="L402">        d.add(rgB);</span>
<span class="nc" id="L403">        generateRegressionReport(regressionA, regressionB, selectedCountries[0], selectedCountries[1]);</span>

<span class="nc" id="L405">        caseDeathChart.setData(d);</span>
<span class="nc" id="L406">    }</span>

    /**
     * Compares regression model and generate a conclusion that which country is better.
     *
     * @param rgA      regression model of the first country.
     * @param rgB      regression model of the second country.
     * @param countryA first country's name.
     * @param countryB second country's name.
     */
    void generateRegressionReport(LinearRegression rgA, LinearRegression rgB, String countryA, String countryB) {
<span class="fc" id="L417">        String output = &quot;Regression report:\n\n&quot;;</span>
<span class="fc" id="L418">        output += String.format(&quot;Relationship of %s - %s\n&quot;, countryA, rgA.toString());</span>
<span class="fc" id="L419">        output += String.format(&quot;Relationship of %s - %s\n\n&quot;, countryB, rgB.toString());</span>

<span class="fc bfc" id="L421" title="All 2 branches covered.">        if (rgA.slope() == rgB.slope()) {</span>
<span class="fc" id="L422">            output += String.format(&quot;Conclusion: both countries have equally good healthcare (%.3f = %.3f).&quot;, rgA.slope(), rgB.slope());</span>
<span class="pc bpc" id="L423" title="1 of 2 branches missed.">        } else if (rgA.slope() &gt; rgB.slope()) {</span>
<span class="nc" id="L424">            output += String.format(&quot;Conclusion: %s has better healthcare since it has lower slope (%.3f &lt; %.3f).&quot;, countryA, rgB.slope(), rgA.slope());</span>
        } else {
<span class="fc" id="L426">            output += String.format(&quot;Conclusion: %s has better healthcare since it has lower slope (%.3f &lt; %.3f).&quot;, countryB, rgA.slope(), rgB.slope());</span>
        }

<span class="fc" id="L429">        regressionReport.setText(output);</span>
<span class="fc" id="L430">    }</span>

    /**
     * Reconfigure the range of slider.
     *
     * @param days the maximum days that a slider can represent.
     */
    void resetSliderRange(int days) {
<span class="pc bpc" id="L438" title="1 of 2 branches missed.">        if (days &lt; 0) return;</span>
<span class="fc" id="L439">        countryASlider.setValue(0);</span>
<span class="fc" id="L440">        countryBSlider.setValue(0);</span>

<span class="fc" id="L442">        countryASlider.setMax(days);</span>
<span class="fc" id="L443">        countryBSlider.setMax(days);</span>
<span class="fc" id="L444">    }</span>

    /**
     * Groups all ratio buttons.
     */
    public void ratioButtonInitialize() {
<span class="fc" id="L450">        dataCaseButton.setToggleGroup(ratioButtonGroups);</span>
<span class="fc" id="L451">        dataDeathButton.setToggleGroup(ratioButtonGroups);</span>
<span class="fc" id="L452">        dataVaccinButton.setToggleGroup(ratioButtonGroups);</span>

<span class="fc" id="L454">        ratioButtonGroups.selectedToggleProperty().addListener((ob, oldVal, newVal) -&gt; {</span>
<span class="nc" id="L455">            dataInstance.focusedData = buttonDataMapping((RadioButton) ratioButtonGroups.getSelectedToggle());</span>
<span class="nc" id="L456">        });</span>
<span class="fc" id="L457">    }</span>

    /**
     * Gets the default values from UI and initialize the data model with the values.
     */
    public void initializeUIDataModel() {
<span class="fc" id="L463">        dataInstance.dataPath = textfieldDataset.textProperty();</span>
<span class="fc" id="L464">        dataInstance.dataPath.addListener((e) -&gt; {</span>
<span class="fc" id="L465">            UIDataModelUtils.setAvailableCountries(dataInstance);</span>
<span class="fc" id="L466">        });</span>

<span class="fc" id="L468">        dataInstance.focusedData = this.getFocusedData();</span>
<span class="fc" id="L469">        dataInstance.start = startDatePicker.getValue();</span>
<span class="fc" id="L470">        dataInstance.end = endDatePicker.getValue();</span>
<span class="fc" id="L471">        dataInstance.acumulativeData = acumulativeCheckButton.selectedProperty();</span>
<span class="fc" id="L472">    }</span>

    /**
     * Gets current selected data.
     *
     * @return current selected data
     */
    InterestedData getFocusedData() {
<span class="pc bpc" id="L480" title="1 of 2 branches missed.">        if (dataCaseButton.isSelected())</span>
<span class="fc" id="L481">            return buttonDataMapping(dataCaseButton);</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">        else if (dataDeathButton.isSelected())</span>
<span class="nc" id="L483">            return buttonDataMapping(dataDeathButton);</span>
        else
<span class="nc" id="L485">            return buttonDataMapping(dataVaccinButton);</span>
    }

    /**
     * Get the interested data that the button represents.
     *
     * @param btn button to check
     * @return interested data
     */
    InterestedData buttonDataMapping(RadioButton btn) {
<span class="fc bfc" id="L495" title="All 2 branches covered.">        if (dataCaseButton == btn)</span>
<span class="fc" id="L496">            return InterestedData.ConfirmedCases;</span>
<span class="pc bpc" id="L497" title="1 of 2 branches missed.">        else if (dataDeathButton == btn)</span>
<span class="nc" id="L498">            return InterestedData.ConfirmedDeaths;</span>
        else
<span class="fc" id="L500">            return InterestedData.RateOfVaccination;</span>
    }

    /**
     * Generate a table and display via TableView UI.
     *
     * @param data data that indicates dataset to search for, and the interested data
     */
    void generateTable(final UIDataModel data) {
<span class="fc" id="L509">        System.out.println(dataInstance.focusedData);</span>
<span class="fc" id="L510">        String col1Title = &quot;&quot;, col2Title = &quot;&quot;;</span>
<span class="pc bpc" id="L511" title="3 of 4 branches missed.">        switch (getFocusedData()) {</span>
            case ConfirmedCases:
<span class="fc" id="L513">                col1Title = &quot;Total Cases&quot;;</span>
<span class="fc" id="L514">                col2Title = &quot;Total Cases (per 1M)&quot;;</span>
<span class="fc" id="L515">                break;</span>
            case ConfirmedDeaths:
<span class="nc" id="L517">                col1Title = &quot;Total Deaths&quot;;</span>
<span class="nc" id="L518">                col2Title = &quot;Total Deaths (per 1M)&quot;;</span>
<span class="nc" id="L519">                break;</span>
            case RateOfVaccination:
<span class="nc" id="L521">                col1Title = &quot;Fully Vaccinated&quot;;</span>
<span class="nc" id="L522">                col2Title = &quot;Rate of Vaccination&quot;;</span>
                break;
        }

<span class="fc" id="L526">        dataTable.getItems().clear();</span>
<span class="fc" id="L527">        dataTable.getColumns().clear();</span>
<span class="fc" id="L528">        TableColumn&lt;Map, String&gt; country = new TableColumn(&quot;Country&quot;);</span>
<span class="fc" id="L529">        TableColumn&lt;Map, String&gt; col1 = new TableColumn(col1Title);</span>
<span class="fc" id="L530">        TableColumn&lt;Map, String&gt; col2 = new TableColumn(col2Title);</span>
<span class="fc" id="L531">        dataTable.getColumns().addAll(country, col1, col2);</span>
<span class="fc" id="L532">        String[] validDate = CheckInput.checkValidDate(dataInstance.start, dataInstance.dataPath.get());</span>
<span class="fc" id="L533">        System.out.println(validDate[0]);</span>

<span class="fc" id="L535">        ObservableList&lt;String&gt; selectedCountries = countryListView.getSelectionModel().getSelectedItems();</span>
<span class="fc" id="L536">        Object[] ISO = dataInstance.getISOList(selectedCountries);</span>
<span class="fc" id="L537">        String[] ISOStrings = Arrays.copyOf(ISO, ISO.length, String[].class);</span>

<span class="fc bfc" id="L539" title="All 2 branches covered.">        if (ISOStrings.length == 0) {</span>
<span class="fc" id="L540">            PromptHelper.showErrorPrompt(window, &quot;Please select at least one country&quot;);</span>
<span class="fc" id="L541">            return;</span>
        }
<span class="fc" id="L543">        ObservableList tableData = TableChartTask.generateTable(dataInstance.dataPath.get(), Arrays.asList(ISOStrings),</span>
<span class="fc" id="L544">                validDate[1], getFocusedData());</span>
<span class="fc" id="L545">        country.setCellValueFactory(new MapValueFactory&lt;&gt;(&quot;country&quot;));</span>
<span class="fc" id="L546">        col1.setCellValueFactory(new MapValueFactory&lt;&gt;(&quot;col1data&quot;));</span>
<span class="fc" id="L547">        col2.setCellValueFactory(new MapValueFactory&lt;&gt;(&quot;col2data&quot;));</span>
<span class="pc bpc" id="L548" title="3 of 4 branches missed.">        switch (dataInstance.focusedData) {</span>
            case ConfirmedCases:
<span class="fc" id="L550">                title.setText(&quot;Number of Confirmed COVID-19 Cases as of &quot;);</span>
<span class="fc" id="L551">                break;</span>
            case ConfirmedDeaths:
<span class="nc" id="L553">                title.setText(&quot;Number of Confirmed COVID-19 Deaths as of &quot;);</span>
<span class="nc" id="L554">                break;</span>
            case RateOfVaccination:
<span class="nc" id="L556">                title.setText(&quot;Rate of Vaccination against COVID-19 as of &quot;);</span>
                break;
        }
<span class="fc" id="L559">        title.setText(title.getText() + validDate[1]);</span>
<span class="fc" id="L560">        dataTable.getItems().addAll(tableData);</span>
<span class="fc" id="L561">    }</span>

    /**
     * Shifting the data according to countryASlider and countryBSlider.
     */
    void shiftingData() {
<span class="nc" id="L567">        long shiftA = (int) countryASlider.valueProperty().get();</span>
<span class="nc" id="L568">        long shiftB = (int) countryBSlider.valueProperty().get();</span>


<span class="nc" id="L571">        shiftCountryData(unshifted.get(0), shifted.get(0), shiftA);</span>
<span class="nc" id="L572">        shiftCountryData(unshifted.get(1), shifted.get(1), shiftB);</span>

<span class="nc" id="L574">        XYChart.Series&lt;String, Float&gt; s1 = DeepCopyUtils.copySeries(shifted.get(0));</span>
<span class="nc" id="L575">        XYChart.Series&lt;String, Float&gt; s2 = DeepCopyUtils.copySeries(shifted.get(1));</span>

<span class="nc" id="L577">        compareChart.setAnimated(false);</span>
<span class="nc" id="L578">        compareChart.getData().clear();</span>
<span class="nc" id="L579">        compareChart.layout();</span>
<span class="nc" id="L580">        compareChart.getData().add(s1);</span>
<span class="nc" id="L581">        compareChart.getData().add(s2);</span>

<span class="nc" id="L583">    }</span>

    /**
     * Shifts a series of confirmed cases data for a country.
     *
     * @param original unshifted data
     * @param updated reference to the shifted data, will be modified
     * @param days days to shift
     */
    void shiftCountryData(XYChart.Series&lt;String, Float&gt; original, XYChart.Series&lt;String, Float&gt; updated, long days) {
<span class="pc bpc" id="L593" title="1 of 2 branches missed.">        if (days &lt;= 0) return;</span>

<span class="fc" id="L595">        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;);</span>

<span class="fc" id="L597">        Iterator&lt;XYChart.Data&lt;String, Float&gt;&gt; ptr = original.getData().iterator();</span>
<span class="fc" id="L598">        Iterator&lt;XYChart.Data&lt;String, Float&gt;&gt; updatePtr = updated.getData().iterator();</span>

<span class="fc bfc" id="L600" title="All 2 branches covered.">        while (ptr.hasNext()) {</span>
<span class="fc" id="L601">            XYChart.Data&lt;String, Float&gt; d = ptr.next();</span>
<span class="fc" id="L602">            XYChart.Data&lt;String, Float&gt; updateD = updatePtr.next();</span>
<span class="fc" id="L603">            LocalDate newDate = LocalDate.parse(d.getXValue(), formatter).plusDays(days);</span>
<span class="fc" id="L604">            updateD.setXValue(newDate.toString());</span>
<span class="fc" id="L605">        }</span>

<span class="fc" id="L607">        updated.getData().sort(Comparator.comparing(XYChart.Data::getXValue));</span>
<span class="fc" id="L608">    }</span>

    /**
     * Fetches the confirmed cases for two selected countries and display the results on the chart.
     *
     * @param data data model
     * @throws Exception the reason why cannot generate the result
     */
    void generateComparisonChart(final UIDataModel data) throws Exception {
<span class="nc" id="L617">        compareChart.getData().clear();</span>

<span class="nc" id="L619">        String iDataset = data.dataPath.get();</span>

<span class="nc" id="L621">        String[] selectedCountries = new String[]{</span>
<span class="nc" id="L622">                countryAListView.getSelectionModel().getSelectedItem(),</span>
<span class="nc" id="L623">                countryBListView.getSelectionModel().getSelectedItem(),</span>
        };

<span class="nc bnc" id="L626" title="All 4 branches missed.">        if (selectedCountries[0] == null || selectedCountries[1] == null) {</span>
<span class="nc" id="L627">            throw new Exception(&quot;Please select two countries.&quot;);</span>
        }

<span class="nc" id="L630">        Object[] ISO = dataInstance.getISOList(FXCollections.observableList(Arrays.asList(selectedCountries)));</span>
<span class="nc" id="L631">        String[] ISOStrings = Arrays.copyOf(ISO, ISO.length, String[].class);</span>

<span class="nc" id="L633">        LocalDate iStartDate = data.start, iEndDate = data.end;</span>
<span class="nc" id="L634">        List&lt;String&gt; checkPeriodInput = CheckInput.checkValidPeriod(iStartDate, iEndDate, iDataset);</span>

<span class="nc bnc" id="L636" title="All 2 branches missed.">        if (checkPeriodInput.size() == 1) {</span>
<span class="nc" id="L637">            throw new Exception(&quot;Please select a valid date period.&quot;);</span>
        } else {
<span class="nc" id="L639">            int days = (int) ChronoUnit.DAYS.between(dataInstance.start, dataInstance.end);</span>
<span class="nc" id="L640">            resetSliderRange(days);</span>
<span class="nc" id="L641">            compareChart.setCreateSymbols(false);</span>
        }

<span class="nc" id="L644">        unshifted = TableChartTask.generateChart(iDataset, Arrays.asList(ISOStrings), checkPeriodInput, getFocusedData());</span>
<span class="nc" id="L645">        shifted = FXCollections.observableArrayList();</span>
<span class="nc" id="L646">        shifted.add(DeepCopyUtils.copySeries(unshifted.get(0)));</span>
<span class="nc" id="L647">        shifted.add(DeepCopyUtils.copySeries(unshifted.get(1)));</span>

<span class="nc" id="L649">        compareChart.setAxisSortingPolicy(LineChart.SortingPolicy.NONE);</span>
<span class="nc" id="L650">        compareChart.setData(shifted);</span>
<span class="nc" id="L651">    }</span>

    /**
     * @param data User input for all controls
     */
    void generateChart(final UIDataModel data) {
<span class="fc" id="L657">        chart.getData().clear();</span>

<span class="fc" id="L659">        String iDataset = data.dataPath.get();</span>

<span class="fc" id="L661">        ObservableList&lt;String&gt; selectedCountries = countryListView.getSelectionModel().getSelectedItems();</span>
<span class="fc" id="L662">        Object[] ISO = dataInstance.getISOList(selectedCountries);</span>
<span class="fc" id="L663">        String[] ISOStrings = Arrays.copyOf(ISO, ISO.length, String[].class);</span>

<span class="pc bpc" id="L665" title="1 of 2 branches missed.">        if (ISOStrings.length == 0) {</span>
<span class="fc" id="L666">            PromptHelper.showErrorPrompt(window, &quot;Please select at least one country.&quot;);</span>
<span class="fc" id="L667">            return;</span>
        }

<span class="nc" id="L670">        LocalDate iStartDate = data.start, iEndDate = data.end;</span>
<span class="nc" id="L671">        List&lt;String&gt; checkPeriodInput = CheckInput.checkValidPeriod(iStartDate, iEndDate, iDataset);</span>
<span class="nc bnc" id="L672" title="All 2 branches missed.">        if (checkPeriodInput.size() == 1) {</span>
<span class="nc" id="L673">            PromptHelper.showErrorPrompt(window, &quot;Please select a valid date period.&quot;);</span>
<span class="nc" id="L674">            return;</span>
        }

<span class="nc bnc" id="L677" title="All 2 branches missed.">        if (!checkPeriodInput.get(checkPeriodInput.size() - 1).isEmpty()) {</span>
<span class="nc" id="L678">            PromptHelper.showInfoPrompt(window, checkPeriodInput.get(checkPeriodInput.size() - 1));</span>
        }

<span class="nc" id="L681">        checkPeriodInput.remove(checkPeriodInput.size() - 1);</span>
<span class="nc bnc" id="L682" title="All 2 branches missed.">        if (checkPeriodInput.get(0).equals(checkPeriodInput.get(1))) chart.setCreateSymbols(true);</span>
<span class="nc" id="L683">        else chart.setCreateSymbols(false);</span>
<span class="nc" id="L684">        ObservableList&lt;XYChart.Series&lt;String, Float&gt;&gt; allData = TableChartTask.generateChart(iDataset, Arrays.asList(ISOStrings), checkPeriodInput, getFocusedData());</span>
<span class="nc bnc" id="L685" title="All 4 branches missed.">        switch (dataInstance.focusedData) {</span>
            case ConfirmedCases:
<span class="nc" id="L687">                title.setText(&quot;Cumulative Confirmed COVID-19 Cases (per 1M)&quot;);</span>
<span class="nc" id="L688">                chart.getYAxis().setLabel(&quot;Cases&quot;);</span>
<span class="nc" id="L689">                break;</span>
            case ConfirmedDeaths:
<span class="nc" id="L691">                title.setText(&quot;Cumulative Confirmed COVID-19 Deaths (per 1M)&quot;);</span>
<span class="nc" id="L692">                chart.getYAxis().setLabel(&quot;Deaths&quot;);</span>
<span class="nc" id="L693">                break;</span>
            case RateOfVaccination:
<span class="nc" id="L695">                title.setText(&quot;Cumulative Rate of Vaccination against COVID-19&quot;);</span>
<span class="nc" id="L696">                chart.getYAxis().setLabel(&quot;Rate&quot;);</span>
                break;
        }
<span class="nc" id="L699">        chart.getXAxis().setLabel(&quot;Date&quot;);</span>
<span class="nc" id="L700">        chart.setData(allData);</span>
<span class="nc" id="L701">    }</span>

    /**
     * @param isTask1 Check if user chooses Task 1
     */
    void showTaskUI(boolean isTask1) {
<span class="pc bpc" id="L707" title="1 of 2 branches missed.">        if (isTask1) {</span>
<span class="fc" id="L708">            title.setText(&quot;Data Table&quot;);</span>
<span class="fc" id="L709">            showPickDateUI();</span>
<span class="fc" id="L710">            stackShow(dataTable);</span>
        } else {
<span class="nc bnc" id="L712" title="All 4 branches missed.">            switch (dataInstance.focusedData) {</span>
                case ConfirmedCases:
<span class="nc" id="L714">                    title.setText(&quot;Cumulative Confirmed COVID-19 Cases (per 1M)&quot;);</span>
<span class="nc" id="L715">                    break;</span>
                case ConfirmedDeaths:
<span class="nc" id="L717">                    title.setText(&quot;Cumulative Confirmed COVID-19 Deaths (per 1M)&quot;);</span>
<span class="nc" id="L718">                    break;</span>
                case RateOfVaccination:
<span class="nc" id="L720">                    title.setText(&quot;Cumulative Rate of Vaccination against COVID-19&quot;);</span>
                    break;
            }
<span class="nc" id="L723">            showPickPeriodUI();</span>
<span class="nc" id="L724">            stackShow(chart);</span>
        }
<span class="fc" id="L726">    }</span>

    /**
     * Hides period UI and display single date picker UI.
     */
    void showPickDateUI() {
<span class="fc" id="L732">        dataRangeTile.setText(&quot;Date&quot;);</span>
<span class="fc" id="L733">        startDateLabel.setText(&quot;Date: &quot;);</span>
<span class="fc" id="L734">        startDatePicker.setVisible(true);</span>
<span class="fc" id="L735">        endDataLabel.setVisible(false);</span>
<span class="fc" id="L736">        endDatePicker.setVisible(false);</span>
<span class="fc" id="L737">    }</span>

    /**
     * Hides single date picker UI and display period UI.
     */
    void showPickPeriodUI() {
<span class="fc" id="L743">        dataRangeTile.setText(&quot;Date Range&quot;);</span>
<span class="fc" id="L744">        startDateLabel.setText(&quot;Start date: &quot;);</span>
<span class="fc" id="L745">        startDatePicker.setVisible(true);</span>
<span class="fc" id="L746">        endDataLabel.setVisible(true);</span>
<span class="fc" id="L747">        endDatePicker.setVisible(true);</span>
<span class="fc" id="L748">    }</span>

    /**
     * Shows report UI.
     *
     * @param type data user is interested in
     */
    void showReportUI(InterestedData type) { // switch the UI of StackPane
<span class="pc bpc" id="L756" title="1 of 4 branches missed.">        switch (type) {</span>
            case ConfirmedCases:
<span class="fc" id="L758">                showPickPeriodUI();</span>
<span class="fc" id="L759">                stackShow(reportA);</span>
<span class="fc" id="L760">                break;</span>
            case RateOfVaccination:
<span class="fc" id="L762">                showPickPeriodUI();</span>
<span class="fc" id="L763">                countryInstruction.setVisible(false);</span>
<span class="fc" id="L764">                stackShow(reportC);</span>
<span class="fc" id="L765">                break;</span>
            case ConfirmedDeaths:
<span class="fc" id="L767">                dataRangeTile.setText(&quot;&quot;);</span>
<span class="fc" id="L768">                startDateLabel.setText(&quot;&quot;);</span>
<span class="fc" id="L769">                endDataLabel.setVisible(false);</span>
<span class="fc" id="L770">                startDatePicker.setVisible(false);</span>
<span class="fc" id="L771">                endDatePicker.setVisible(false);</span>
<span class="fc" id="L772">                countryInstruction.setVisible(false);</span>
<span class="fc" id="L773">                stackShow(reportB);</span>
                break;
        }
<span class="fc" id="L776">    }</span>

    /**
     * Removes a node from stackPane.
     *
     * @param e UI to be removed
     */
    void removeFromStack(Node e) {
        try {
<span class="fc" id="L785">            stack.getChildren().remove(e);</span>
<span class="nc" id="L786">        } catch (Exception exc) {</span>

<span class="fc" id="L788">        }</span>
<span class="fc" id="L789">    }</span>

    /**
     * Shows the UI in stack. This method will ensure only the given is shown on stack.
     *
     * @param e UI to be displayed.
     */
    void stackShow(Node e) {
<span class="fc" id="L797">        removeFromStack(chart);</span>
<span class="fc" id="L798">        removeFromStack(dataTable);</span>
<span class="fc" id="L799">        removeFromStack(reportA);</span>
<span class="fc" id="L800">        removeFromStack(reportB);</span>
<span class="fc" id="L801">        removeFromStack(reportC);</span>

<span class="fc" id="L803">        stack.getChildren().add(e);</span>
<span class="fc" id="L804">        e.setVisible(true);</span>
<span class="fc" id="L805">    }</span>

    /**
     * Error check - to check the number of country selected is one or not
     * @return boolean value that error exist or not
     */
    boolean errorCheckOneCountry() {
<span class="fc" id="L812">        Object[] ISO = dataInstance.getISOList(countryListView.getSelectionModel().getSelectedItems());</span>
<span class="fc" id="L813">        String[] ISOStrings = Arrays.copyOf(ISO, ISO.length, String[].class);</span>
<span class="pc bpc" id="L814" title="1 of 2 branches missed.">        if (ISOStrings.length == 0) {</span>
<span class="fc" id="L815">            PromptHelper.showErrorPrompt(window, &quot;Please select one country&quot;);</span>
<span class="fc" id="L816">            return true;</span>
        }
<span class="nc bnc" id="L818" title="All 2 branches missed.">        if (ISOStrings.length &gt; 1) {</span>
<span class="nc" id="L819">            PromptHelper.showErrorPrompt(window, &quot;Please select one country only&quot;);</span>
<span class="nc" id="L820">            return true;</span>
        }
<span class="nc" id="L822">        return false;</span>
    }

    /**
     * UI output - Scatter Plot of the death cases and the confirmed rate.
     *
     * @param data user inputed for all controls
     */
    void generateChartB1(final UIDataModel data) {
<span class="nc" id="L831">        chartReportB1.getData().clear();</span>

<span class="nc" id="L833">        Object[] ISO = dataInstance.getISOList(countryListView.getSelectionModel().getSelectedItems());</span>
<span class="nc" id="L834">        String[] ISOStrings = Arrays.copyOf(ISO, ISO.length, String[].class);</span>
<span class="nc" id="L835">        double[] regression_result = new double[3];</span>
<span class="nc" id="L836">        String x_data = &quot;new_cases_per_million&quot;;</span>
<span class="nc" id="L837">        String y_data = &quot;new_deaths_per_million&quot;;</span>

<span class="nc" id="L839">        Series&lt;Float, Float&gt; scatterData = ReportTask.generateChartB(data.dataPath.get(), ISOStrings[0], x_data, y_data, regression_result, 1);</span>
<span class="nc" id="L840">        chartReportB1.getData().addAll(scatterData);</span>
<span class="nc" id="L841">        ResultB1.setText(ReportTask.correlationAnalysisB1(regression_result));</span>
<span class="nc" id="L842">        taskB1correlation.setText(&quot;Correlation = &quot; + regression_result[0] + &quot;\nNumber of data = &quot; + Math.round(regression_result[1]) + &quot;\nSlope = &quot; + regression_result[2]);</span>
<span class="nc" id="L843">    }</span>

    /**
     * UI output - Scatter Plot of the death cases and the vaccination rate that could the citizens be immediately vaccinated during a breakout.
     *
     * @param data user inputed for all controls
     */
    void generateChartB2(final UIDataModel data) {
<span class="nc" id="L851">        chartReportB2.getData().clear();</span>

<span class="nc" id="L853">        Object[] ISO = dataInstance.getISOList(countryListView.getSelectionModel().getSelectedItems());</span>
<span class="nc" id="L854">        String[] ISOStrings = Arrays.copyOf(ISO, ISO.length, String[].class);</span>
<span class="nc" id="L855">        double[] regression_result = new double[3];</span>
<span class="nc" id="L856">        String x_data = &quot;new_deaths_per_million&quot;;</span>
<span class="nc" id="L857">        String y_data = &quot;new_vaccinations_smoothed_per_million&quot;;</span>

<span class="nc" id="L859">        Series&lt;Float, Float&gt; scatterData = ReportTask.generateChartB(data.dataPath.get(), ISOStrings[0], x_data, y_data, regression_result, 1);</span>
<span class="nc" id="L860">        chartReportB2.getData().addAll(scatterData);</span>
<span class="nc" id="L861">        ResultB2.setText(ReportTask.correlationAnalysisB2(regression_result));</span>
<span class="nc" id="L862">        taskB2correlation.setText(&quot;Correlation = &quot; + regression_result[0] + &quot;\nNumber of data = &quot; + Math.round(regression_result[1]) + &quot;\nSlope = &quot; + regression_result[2]);</span>
<span class="nc" id="L863">    }</span>

    /**
     * UI output - Scatter Plot of the vaccination rate and the death cases to verify the efficiency of vaccines.
     *
     * @param data user inputed for all controls
     */
    void generateChartB3(final UIDataModel data) {
<span class="nc" id="L871">        chartReportB3.getData().clear();</span>

<span class="nc" id="L873">        Object[] ISO = dataInstance.getISOList(countryListView.getSelectionModel().getSelectedItems());</span>
<span class="nc" id="L874">        String[] ISOStrings = Arrays.copyOf(ISO, ISO.length, String[].class);</span>
<span class="nc" id="L875">        double[] regression_result = new double[3];</span>
<span class="nc" id="L876">        String x_data = &quot;new_vaccinations_smoothed_per_million&quot;;</span>
<span class="nc" id="L877">        String y_data = &quot;new_deaths_per_million&quot;;</span>
<span class="nc" id="L878">        int dayChecked = (int) SliderReportB3.getValue();</span>

<span class="nc" id="L880">        Series&lt;Float, Float&gt; scatterData = ReportTask.generateChartB(data.dataPath.get(), ISOStrings[0], x_data, y_data, regression_result, dayChecked);</span>
<span class="nc" id="L881">        chartReportB3.getData().addAll(scatterData);</span>
<span class="nc" id="L882">        ResultB3.setText(ReportTask.correlationAnalysisB3(regression_result, dayChecked));</span>
<span class="nc" id="L883">        taskB3correlation.setText(&quot;Correlation = &quot; + regression_result[0] + &quot;\nNumber of data = &quot; + Math.round(regression_result[1]) + &quot;\nSlope = &quot; + regression_result[2]);</span>
<span class="nc" id="L884">    }</span>

    void generateChartC1(final UIDataModel data) {
        // no need to check input, just use the dataset
<span class="fc" id="L888">        chartReportC1.getData().clear();</span>
<span class="fc" id="L889">        tableReportC1.getItems().clear();</span>
<span class="fc" id="L890">        tableReportC1.getColumns().clear();</span>
<span class="fc" id="L891">        String iDataset = data.dataPath.get();</span>
<span class="fc" id="L892">        ObservableList&lt;XYChart.Series&lt;String, Float&gt;&gt; chartData = ReportTask.generateChartC1(iDataset);</span>
<span class="fc" id="L893">        chartReportC1.setData(chartData);</span>
        // generate table of countries in different quartiles
<span class="fc" id="L895">        String[] quartiles = {&quot;Quartile 1&quot;, &quot;Quartile 2&quot;, &quot;Quartile 3&quot;, &quot;Quartile 4&quot;};</span>

<span class="fc bfc" id="L897" title="All 2 branches covered.">        for (int i = 0; i &lt; 4; ++i) {</span>
<span class="fc" id="L898">            TableColumn&lt;Map, String&gt; q = new TableColumn(quartiles[i]);</span>
<span class="fc" id="L899">            q.setCellValueFactory(new MapValueFactory&lt;&gt;(quartiles[i]));</span>
<span class="fc" id="L900">            tableReportC1.getColumns().add(q);</span>
        }
<span class="fc" id="L902">        ObservableList tableData = ReportTask.generateTableC1();</span>
<span class="fc" id="L903">        tableReportC1.getItems().addAll(tableData);</span>
<span class="fc" id="L904">        chartReportC1Title.setVisible(true);</span>
<span class="fc" id="L905">    }</span>

    /**
     * @param data User input for all controls
     */
    void generateChartC2(final UIDataModel data) {
        // no need to check input, just use the dataset
<span class="fc" id="L912">        chartReportC2.getData().clear();</span>
<span class="fc" id="L913">        List&lt;LocalDate&gt; period = DataAnalysis.getValidPeriod(data.dataPath.get());</span>
<span class="fc" id="L914">        LocalDate lastDate = period.get(1);</span>
<span class="fc" id="L915">        ObservableList scatterData = ReportTask.generateChartC2(data.dataPath.get(), lastDate);</span>
<span class="fc" id="L916">        chartReportC2.setData(scatterData);</span>
<span class="fc" id="L917">        System.out.println(&quot;Got some data&quot;);</span>
<span class="fc" id="L918">        String title = &quot;Figure 2. Scatter plot of vaccination rates against HDI as of &quot;</span>
<span class="fc" id="L919">                + lastDate.toString() + &quot; labelled by continents. While not all countries &quot;</span>
                + &quot;with high HDI have high vaccination rates, most countries with &quot;
                + &quot;low HDI have minimal vaccination rates.&quot;;
<span class="fc" id="L922">        chartReportC2Title.setText(title);</span>
<span class="fc" id="L923">        chartReportC2Title.setVisible(true);</span>
<span class="fc" id="L924">    }</span>

    /**
     * @param data User input for all controls
     */
    void generateChartC3(final UIDataModel data) {
<span class="fc" id="L930">        chartReportC3.getData().clear();</span>

<span class="fc" id="L932">        String iDataset = data.dataPath.get();</span>

<span class="fc" id="L934">        ObservableList&lt;String&gt; selectedCountries = countryListView.getSelectionModel().getSelectedItems();</span>
<span class="fc" id="L935">        Object[] ISO = dataInstance.getISOList(selectedCountries);</span>
<span class="fc" id="L936">        String[] ISOStrings = Arrays.copyOf(ISO, ISO.length, String[].class);</span>

<span class="pc bpc" id="L938" title="1 of 2 branches missed.">        if (ISOStrings.length == 0) {</span>
<span class="fc" id="L939">            Alert error = new Alert(AlertType.ERROR);</span>
<span class="fc" id="L940">            error.setContentText(&quot;Please select at least one country&quot;);</span>
<span class="fc" id="L941">            error.show();</span>
<span class="fc" id="L942">            return;</span>
        }
<span class="nc bnc" id="L944" title="All 2 branches missed.">        if (ISOStrings.length &gt; 1) {</span>
<span class="nc" id="L945">            Alert error = new Alert(AlertType.ERROR);</span>
<span class="nc" id="L946">            error.setContentText(&quot;Please select one country only&quot;);</span>
<span class="nc" id="L947">            error.show();</span>
<span class="nc" id="L948">            return;</span>
        }

<span class="nc" id="L951">        LocalDate iStartDate = data.start, iEndDate = data.end;</span>
<span class="nc" id="L952">        List&lt;String&gt; checkPeriodInput = CheckInput.checkValidPeriod(iStartDate, iEndDate, iDataset);</span>
<span class="nc bnc" id="L953" title="All 2 branches missed.">        if (checkPeriodInput.size() == 1) {</span>
<span class="nc" id="L954">            Alert error = new Alert(AlertType.ERROR);</span>
<span class="nc" id="L955">            error.setContentText(&quot;Please select a valid date period&quot;);</span>
<span class="nc" id="L956">            error.show();</span>
<span class="nc" id="L957">            return;</span>
        }
<span class="nc bnc" id="L959" title="All 2 branches missed.">        if (!checkPeriodInput.get(checkPeriodInput.size() - 1).isEmpty()) {</span>
<span class="nc" id="L960">            Alert info = new Alert(AlertType.INFORMATION);</span>
<span class="nc" id="L961">            info.setContentText(checkPeriodInput.get(checkPeriodInput.size() - 1));</span>
<span class="nc" id="L962">            info.show();</span>
        }
<span class="nc" id="L964">        checkPeriodInput.remove(checkPeriodInput.size() - 1);</span>
<span class="nc bnc" id="L965" title="All 2 branches missed.">        if (checkPeriodInput.get(0).equals(checkPeriodInput.get(1))) chartReportC3.setCreateSymbols(true);</span>
<span class="nc" id="L966">        else chartReportC3.setCreateSymbols(false);</span>
<span class="nc" id="L967">        ObservableList&lt;XYChart.Series&lt;String, Float&gt;&gt; allData = ReportTask.generateChartC3(iDataset, ISOStrings[0], checkPeriodInput);</span>
<span class="nc bnc" id="L968" title="All 2 branches missed.">        if (allData == null) {</span>
<span class="nc" id="L969">            Alert error = new Alert(AlertType.ERROR);</span>
<span class="nc" id="L970">            error.setContentText(&quot;Insufficient information from selected country&quot;);</span>
<span class="nc" id="L971">            error.show();</span>
<span class="nc" id="L972">            return;</span>
        }
<span class="nc" id="L974">        chartReportC3Title.setVisible(true);</span>
<span class="nc" id="L975">        chartReportC3.setData(allData);</span>
<span class="nc" id="L976">    }</span>

    @Override
    public void initialize(URL location, ResourceBundle resources) {
<span class="fc" id="L980">        initialize();</span>
<span class="fc" id="L981">    }</span>
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>