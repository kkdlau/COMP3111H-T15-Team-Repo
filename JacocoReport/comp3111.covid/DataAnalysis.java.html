<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataAnalysis.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">deCOVID</a> &gt; <a href="index.source.html" class="el_package">comp3111.covid</a> &gt; <span class="el_source">DataAnalysis.java</span></div><h1>DataAnalysis.java</h1><pre class="source lang-java linenums">package comp3111.covid;

import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.*;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.scene.chart.XYChart;
import org.apache.commons.csv.*;
import edu.duke.*;

/**
 * Data Explorer on COVID-19
 *
 * @author &lt;a href=mailto:namkiu@ust.hk&gt;Namkiu Chan&lt;/a&gt;
 * @version 1.1
 */
<span class="nc" id="L19">public class DataAnalysis {</span>
    /**
     * @param dataset Filename of dataset
     * @return CSVParser
     */
    public static CSVParser getFileParser(String dataset) {
        try {
<span class="fc" id="L26">            FileResource fr = new FileResource(&quot;dataset/&quot; + dataset);</span>

<span class="fc" id="L28">            return fr.getCSVParser(true);</span>
<span class="fc" id="L29">        } catch (Exception e) {</span>
<span class="fc" id="L30">            return null;</span>
        }
    }

    /**
     * Retrieves the confirmed cases from given dataset for a country.
     * @param dataset dataset
     * @param iso_code country ISO
     * @return confirmed cases
     */
    public static String getConfirmedCases(String dataset, String iso_code) {
<span class="fc" id="L41">        String oReport = &quot;&quot;;</span>
<span class="fc" id="L42">        long confirmedCases = 0;</span>
<span class="fc" id="L43">        long numRecord = 0;</span>
<span class="fc" id="L44">        long totalNumRecord = 0;</span>

<span class="fc bfc" id="L46" title="All 2 branches covered.">        for (CSVRecord rec : getFileParser(dataset)) {</span>

<span class="fc bfc" id="L48" title="All 2 branches covered.">            if (rec.get(&quot;iso_code&quot;).equals(iso_code)) {</span>
<span class="fc" id="L49">                String s = rec.get(&quot;new_cases&quot;);</span>
<span class="pc bpc" id="L50" title="1 of 2 branches missed.">                if (!s.equals(&quot;&quot;)) {</span>
<span class="fc" id="L51">                    confirmedCases += Long.parseLong(s);</span>
<span class="fc" id="L52">                    numRecord++;</span>
                }
            }
<span class="fc" id="L55">            totalNumRecord++;</span>
<span class="fc" id="L56">        }</span>

<span class="fc" id="L58">        oReport = String.format(&quot;Dataset (%s): %,d Records\n\n&quot;, dataset, totalNumRecord);</span>
<span class="fc" id="L59">        oReport += String.format(&quot;[Summary (%s)]\n&quot;, iso_code);</span>
<span class="fc" id="L60">        oReport += String.format(&quot;Number of Confirmed Cases: %,d\n&quot;, confirmedCases);</span>
<span class="fc" id="L61">        oReport += String.format(&quot;Number of Days Reported: %,d\n&quot;, numRecord);</span>

<span class="fc" id="L63">        return oReport;</span>
    }

    /**
     * Retrieves the confirmed deaths from given dataset for a country.
     * @param dataset dataset
     * @param iso_code country ISO
     * @return confirmed deaths
     */
    public static String getConfirmedDeaths(String dataset, String iso_code) {
<span class="fc" id="L73">        String oReport = &quot;&quot;;</span>
<span class="fc" id="L74">        long confirmedDeaths = 0;</span>
<span class="fc" id="L75">        long numRecord = 0;</span>
<span class="fc" id="L76">        long totalNumRecord = 0;</span>

<span class="fc bfc" id="L78" title="All 2 branches covered.">        for (CSVRecord rec : getFileParser(dataset)) {</span>

<span class="fc bfc" id="L80" title="All 2 branches covered.">            if (rec.get(&quot;iso_code&quot;).equals(iso_code)) {</span>
<span class="fc" id="L81">                String s = rec.get(&quot;new_deaths&quot;);</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">                if (!s.equals(&quot;&quot;)) {</span>
<span class="fc" id="L83">                    confirmedDeaths += Long.parseLong(s);</span>
<span class="fc" id="L84">                    numRecord++;</span>
                }
            }
<span class="fc" id="L87">            totalNumRecord++;</span>
<span class="fc" id="L88">        }</span>

<span class="fc" id="L90">        oReport = String.format(&quot;Dataset (%s): %,d Records\n\n&quot;, dataset, totalNumRecord);</span>
<span class="fc" id="L91">        oReport += String.format(&quot;[Summary (%s)]\n&quot;, iso_code);</span>
<span class="fc" id="L92">        oReport += String.format(&quot;Number of Deaths: %,d\n&quot;, confirmedDeaths);</span>
<span class="fc" id="L93">        oReport += String.format(&quot;Number of Days Reported: %,d\n&quot;, numRecord);</span>

<span class="fc" id="L95">        return oReport;</span>
    }

    /**
     * Retrieves the rate of vaccination from given dataset for a country.
     * @param dataset dataset
     * @param iso_code country ISO
     * @return rate of vaccination
     */
    public static String getRateOfVaccination(String dataset, String iso_code) {
<span class="fc" id="L105">        String oReport = &quot;&quot;;</span>
<span class="fc" id="L106">        long fullyVaccinated = 0;</span>
<span class="fc" id="L107">        long numRecord = 0;</span>
<span class="fc" id="L108">        long totalNumRecord = 0;</span>
<span class="fc" id="L109">        long population = 0;</span>
<span class="fc" id="L110">        float rate = 0.0f;</span>

<span class="fc bfc" id="L112" title="All 2 branches covered.">        for (CSVRecord rec : getFileParser(dataset)) {</span>

<span class="fc bfc" id="L114" title="All 2 branches covered.">            if (rec.get(&quot;iso_code&quot;).equals(iso_code)) {</span>

<span class="fc" id="L116">                String s1 = rec.get(&quot;people_fully_vaccinated&quot;);</span>
<span class="fc" id="L117">                String s2 = rec.get(&quot;population&quot;);</span>
<span class="pc bpc" id="L118" title="1 of 4 branches missed.">                if (!s1.equals(&quot;&quot;) &amp;&amp; !s2.equals(&quot;&quot;)) {</span>
<span class="fc" id="L119">                    fullyVaccinated = Long.parseLong(s1);</span>
<span class="fc" id="L120">                    population = Long.parseLong(s2);</span>
<span class="fc" id="L121">                    numRecord++;</span>
                }
            }
<span class="fc" id="L124">            totalNumRecord++;</span>
<span class="fc" id="L125">        }</span>

<span class="pc bpc" id="L127" title="1 of 2 branches missed.">        if (population != 0)</span>
<span class="fc" id="L128">            rate = (float) fullyVaccinated / population * 100;</span>

<span class="fc" id="L130">        oReport = String.format(&quot;Dataset (%s): %,d Records\n\n&quot;, dataset, totalNumRecord);</span>
<span class="fc" id="L131">        oReport += String.format(&quot;[Summary (%s)]\n&quot;, iso_code);</span>
<span class="fc" id="L132">        oReport += String.format(&quot;Number of People Fully Vaccinated: %,d\n&quot;, fullyVaccinated);</span>
<span class="fc" id="L133">        oReport += String.format(&quot;Population: %,d\n&quot;, population);</span>
<span class="fc" id="L134">        oReport += String.format(&quot;Rate of Vaccination: %.2f%%\n&quot;, rate);</span>
<span class="fc" id="L135">        oReport += String.format(&quot;Number of Days Reported: %,d\n&quot;, numRecord);</span>

<span class="fc" id="L137">        return oReport;</span>
    }

    /**
     * Gets a valid date that is available in the dataset.
     *
     * @param dataset dataset
     * @param date date to check
     * @return valid date
     */
    public static LocalDate getValidDate(String dataset, LocalDate date) {

<span class="fc" id="L149">        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;M/d/uuuu&quot;);</span>
<span class="fc" id="L150">        LocalDate latest = null, earliest = null;</span>

<span class="fc bfc" id="L152" title="All 2 branches covered.">        for (CSVRecord rec : getFileParser(dataset)) {</span>
<span class="fc" id="L153">            LocalDate readDate = LocalDate.parse(rec.get(&quot;date&quot;), formatter);</span>
<span class="pc bpc" id="L154" title="1 of 4 branches missed.">            if (latest == null &amp;&amp; earliest == null) {</span>
<span class="fc" id="L155">                latest = readDate;</span>
<span class="fc" id="L156">                earliest = readDate;</span>
            }
<span class="fc bfc" id="L158" title="All 2 branches covered.">            if (readDate.compareTo(latest) &gt; 0) {</span>
<span class="fc" id="L159">                latest = readDate;</span>
            }
<span class="fc bfc" id="L161" title="All 2 branches covered.">            if (readDate.compareTo(earliest) &lt; 0) {</span>
<span class="fc" id="L162">                earliest = readDate;</span>
            }
<span class="fc" id="L164">        }</span>

<span class="fc bfc" id="L166" title="All 4 branches covered.">        if (date == null || date.compareTo(latest) &gt; 0) {</span>
<span class="fc" id="L167">            return latest;</span>
        }
<span class="fc bfc" id="L169" title="All 2 branches covered.">        if (date.compareTo(earliest) &lt; 0) {</span>
<span class="fc" id="L170">            return earliest;</span>
        }
<span class="fc" id="L172">        return date;</span>
    }

    /**
     * @param dataset Filename of dataset
     * @return Earliest and latest date in dataset
     */
    public static List&lt;LocalDate&gt; getValidPeriod(String dataset) {
<span class="fc" id="L180">        DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;M/d/uuuu&quot;);</span>
<span class="fc" id="L181">        LocalDate earliest = null, latest = null;</span>
<span class="fc bfc" id="L182" title="All 2 branches covered.">        for (CSVRecord rec : getFileParser(dataset)) {</span>

<span class="fc" id="L184">            LocalDate readDate = LocalDate.parse(rec.get(&quot;date&quot;), formatter);</span>
<span class="pc bpc" id="L185" title="1 of 4 branches missed.">            if (earliest == null &amp;&amp; latest == null) {</span>
<span class="fc" id="L186">                latest = readDate;</span>
<span class="fc" id="L187">                earliest = readDate;</span>
            }
<span class="fc bfc" id="L189" title="All 2 branches covered.">            if (readDate.compareTo(earliest) &lt; 0) {</span>
<span class="fc" id="L190">                earliest = readDate;</span>
            }
<span class="fc bfc" id="L192" title="All 2 branches covered.">            if (readDate.compareTo(latest) &gt; 0) {</span>
<span class="fc" id="L193">                latest = readDate;</span>
            }
<span class="fc" id="L195">        }</span>
<span class="fc" id="L196">        List&lt;LocalDate&gt; validPeriod = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L197">        validPeriod.add(earliest);</span>
<span class="fc" id="L198">        validPeriod.add(latest);</span>
<span class="fc" id="L199">        return validPeriod;</span>
    }

    /**
     * @param dataset Filename for dataset
     * @return Map for location and ISO codes
     */
    public static Map&lt;String, String&gt; getAllLocationIso(String dataset) {
        try {
<span class="fc" id="L208">            LinkedHashSet&lt;String&gt; uniqueLocations = new LinkedHashSet();</span>
<span class="fc" id="L209">            LinkedHashSet&lt;String&gt; uniqueIsoCodes = new LinkedHashSet();</span>
<span class="fc bfc" id="L210" title="All 2 branches covered.">            for (CSVRecord rec : getFileParser(dataset)) {</span>
<span class="fc" id="L211">                uniqueLocations.add(rec.get(&quot;location&quot;));</span>
<span class="fc" id="L212">                uniqueIsoCodes.add(rec.get(&quot;iso_code&quot;));</span>
<span class="fc" id="L213">            }</span>
<span class="fc" id="L214">            List&lt;String&gt; uniqueLocList = new ArrayList&lt;String&gt;(uniqueLocations);</span>
<span class="fc" id="L215">            List&lt;String&gt; uniqueIsoCodeList = new ArrayList&lt;String&gt;(uniqueIsoCodes);</span>

<span class="pc bpc" id="L217" title="1 of 2 branches missed.">            if (uniqueLocList.size() != uniqueIsoCodeList.size()) {</span>
<span class="nc" id="L218">                System.out.println(&quot;Something wrong with dataset&quot;);</span>
            } else {
<span class="fc" id="L220">                System.out.println(&quot;Ok, same length&quot;);</span>
            }
<span class="fc" id="L222">            Map&lt;String, String&gt; locIsoCodeMap = new HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L223" title="All 2 branches covered.">            for (int i = 0; i &lt; uniqueLocations.size(); ++i) {</span>
<span class="fc" id="L224">                locIsoCodeMap.put(uniqueLocList.get(i), uniqueIsoCodeList.get(i));</span>
                //System.out.println(uniqueLocList.get(i) + &quot;--&quot;);
            }
<span class="fc" id="L227">            System.out.println(&quot;Finished allocating to map&quot;);</span>
<span class="fc" id="L228">            return locIsoCodeMap;</span>
<span class="fc" id="L229">        } catch (Exception e) {</span>
<span class="fc" id="L230">            return new HashMap&lt;&gt;();</span>
        }
    }

    /**
     * Search for the confirmed cases and confirmed deaths that match the given two countries.
     *
     * @param dataset     dataset to be searched.
     * @param countryAISO ISO representation for the first country.
     * @param countryBISO ISO representation for the second country.
     * @return A list that contains the confirmed cases and confirmed deaths.
     */
    public static ObservableList casesAndDeathsData(String dataset, String countryAISO, String countryBISO) {
<span class="fc" id="L243">        XYChart.Series&lt;Float, Float&gt; countryA = new XYChart.Series();</span>
<span class="fc" id="L244">        XYChart.Series&lt;Float, Float&gt; countryB = new XYChart.Series();</span>

<span class="fc bfc" id="L246" title="All 2 branches covered.">        for (CSVRecord rec : getFileParser(dataset)) {</span>
<span class="fc" id="L247">            String iso = rec.get(&quot;iso_code&quot;);</span>
<span class="fc bfc" id="L248" title="All 4 branches covered.">            if (iso.equals(countryAISO) || iso.equals(countryBISO)) {</span>
<span class="fc" id="L249">                String numCases = rec.get(&quot;total_cases_per_million&quot;);</span>
<span class="fc" id="L250">                String numDeaths = rec.get(&quot;total_deaths_per_million&quot;);</span>
<span class="fc bfc" id="L251" title="All 4 branches covered.">                if (numCases.isEmpty() || numDeaths.isEmpty()) continue;</span>

<span class="fc" id="L253">                float cases = Float.valueOf(numCases);</span>
<span class="fc" id="L254">                float deaths = Float.valueOf(numDeaths);</span>
<span class="fc bfc" id="L255" title="All 2 branches covered.">                if (iso.equals(countryAISO)) {</span>
<span class="fc" id="L256">                    countryA.getData().add(new XYChart.Data&lt;&gt;(cases, deaths));</span>
                } else {
<span class="fc" id="L258">                    countryB.getData().add(new XYChart.Data&lt;&gt;(cases, deaths));</span>
                }
            }
<span class="fc" id="L261">        }</span>

        ObservableList&lt;XYChart.Series&lt;Float, Float&gt;&gt; allData =
<span class="fc" id="L264">                FXCollections.observableArrayList();</span>

<span class="fc" id="L266">        allData.add(countryA);</span>
<span class="fc" id="L267">        allData.add(countryB);</span>

<span class="fc" id="L269">        return allData;</span>
    }

    /**
     * @param iDataset Filename of dataset
     * @param variable Target variable to get the quartiles
     * @return 4 quartile values
     */
    public static Float[] getQuartiles(String iDataset, String variable) {
        // assume that one country only has ONE value for this variable
        // provided that datasets are similar to given one, suitable for:
        // population, median_age, aged_65_older, aged_70_older, gdp_per_capita, extreme_poverty
        // cardiovasc_death_rate, diabetes, female_smokers, male_smokers,
        // hospital_beds_per_thousand, life_expectancy, human_development_index, excess_mortality,
<span class="fc" id="L283">        Set&lt;Float&gt; set = new HashSet&lt;Float&gt;();</span>
<span class="fc" id="L284">        String prevISO = &quot;&quot;;</span>
<span class="fc" id="L285">        String ISO = &quot;&quot;;</span>
<span class="fc" id="L286">        float GDP = 0.0f;</span>
<span class="fc" id="L287">        String s1 = &quot;&quot;;</span>
<span class="fc bfc" id="L288" title="All 2 branches covered.">        for (CSVRecord rec : getFileParser(iDataset)) {</span>
<span class="fc" id="L289">            ISO = rec.get(&quot;iso_code&quot;);</span>
<span class="fc bfc" id="L290" title="All 2 branches covered.">            if (ISO.equals(prevISO)) continue;</span>
<span class="fc" id="L291">            prevISO = ISO;</span>
<span class="fc" id="L292">            s1 = rec.get(variable);</span>
<span class="fc bfc" id="L293" title="All 2 branches covered.">            if (!s1.isEmpty()) {</span>
<span class="fc" id="L294">                GDP = Float.parseFloat(s1);</span>
<span class="fc" id="L295">                set.add(GDP);</span>
            }
<span class="fc" id="L297">        }</span>
        try {
<span class="fc" id="L299">            Float[] list = new Float[set.size()];</span>
<span class="fc" id="L300">            set.toArray(list);</span>
<span class="fc" id="L301">            System.out.println(&quot;BP1&quot;);</span>
<span class="fc" id="L302">            Arrays.sort(list);</span>
<span class="fc" id="L303">            System.out.println(&quot;BP2&quot;);</span>
<span class="fc" id="L304">            Float[] quartile = new Float[4];</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">            for (int i = 1; i &lt;= 4; ++i) {</span>
<span class="fc" id="L306">                int n = (int) Math.round(list.length * i / 4);</span>
<span class="fc" id="L307">                quartile[i - 1] = list[n - 1];</span>
            }
<span class="fc" id="L309">            System.out.println(quartile[0]);</span>
<span class="fc" id="L310">            System.out.println(quartile[1]);</span>
<span class="fc" id="L311">            System.out.println(quartile[2]);</span>
<span class="fc" id="L312">            System.out.println(quartile[3]);</span>
<span class="fc" id="L313">            return quartile;</span>
<span class="nc" id="L314">        } catch (Exception e) {</span>
<span class="nc" id="L315">            System.out.println(e);</span>
<span class="nc" id="L316">            return null;</span>
        }


    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>